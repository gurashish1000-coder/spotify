# Spotify Backend - Microservices

Implementing backend Java API using 2 microservices that will communicate with each other to accomplish specific use-cases. I have use MongoDB and Neo4J databases for the two services, and will be implementing this project using the Java Spring framework.

## Testing Endpoints

To test the endpoints I used Postman.

### Sending a Request 

- Open up Postman and select the type of request you would like to send 
- Enter in your request url 
- Open up the request body tab and select raw
- Enter in your request body data into the test box 
- Click Send 

<img src="images/postman.PNG"  >



## Project/IDE Setup

### Command Line

- Install maven 

- To compile your code simply run mvn compile in the root directory (the folder that has pom.xml) 

- To run your code run mvn exec:java


#### Eclipse

- File → Import → Maven → Existing Maven Projects 
- Navigate to the project location 
- Right click the project → Maven Build… 
- Input compile exec:java in the Goals input box 
- Click apply then run/close 
- You can now run the project by pressing the green play button

#### Neo4j

- Download and install Neo4j desktop
- Add Database and create a local Graph
- Set the `username: neo4j`
- Set the `password: 1234`
- Select the graph version 3.5.17 for this project
- Start the Neo4j Graph and use the browser for visual help
- Now the server will not disconnect when the project is run in java

#### MongoDB

- I used Mongo version 4.0 major stable release for this project

- Download and install MongoDB community compass as a means of visualizing your db transactions

- Do not change the default port and the default mongo credentials.

- The mongodb URL must be localhost

- The records mirror the format of the PUT body

- Song Schema:

  - _id - The ObjectId of the document (i.e. a unique identifier for each document). The id is auto-generated by Mongo when a document is inserted into the database 
  - songName - The name of the song 
  - songArtistFullName - The full name of the artist of the song 
  - songAlbum - The album the song belongs to 
  - songAmountFavourites - The amount of Profiles that have favourited the Song

  ​	

#### STEPS

1. Clone the project code repo 
2. Import both services (Song and Profile) in Eclipse as individual Maven projects (File → Import → Maven → Existing Maven Project) from the clone repo under 
3. Right click each project and click “Run As” → “Java Application” to run service. Note: You will not need to restart each service on a code change, the server will auto-refresh (there is not need to do any maven compilation, Eclipse will handle all that) 
4. Click on the blue monitor to switch between the console output of both microservices

## API Usage

The following REST API endpoints run on port 8080. For those unfamiliar with REST a detailed description can be found here (https://www.codecademy.com/articles/what-is-rest). 

### SONG MICROSERVICE

- #### GET /getSongTitleById/{songId}

  - Description: Retrieves the song title given the song  

  - URL Parameters: songId - a String that represents the _id of a specific song 

  - Expected Response: 

    - “status” 
      - “OK”, if the title was retrieved successfully 
      - <string>, any other status if the song was not retrieved successfully 
    - “data”: , the title of the song that was retrieved 

  - Example Response: 

    - ```
      {
      "status": "OK",
      "data": "Never going to give you up"
      }
      ```

- #### DELETE /deleteSongById/{songId}

  - Description: Deletes the song from the MongoDB database and from all Profiles that have the songId added in their “favourites” list 
  - URL Parameters: songId - a String that represents the _id of a specific song 
  - Expected Response: 
    - "status"
      - “OK”, if the song was deleted successfully from all locations 
      - <string>, any other status if the song was unable to be deleted

  #### POST /addSong

  - Description: Adds a Song to the Song database

  - Body Parameters: 

    - songName - The name of the song 
    - songArtistFullName - The name of the song artist 
    - songAlbum - The album the song is a part of

  - Expected Response: 

    - "status"
      - “OK”,  if the song was deleted successfully from all locations
      - <string>, any other status if the song unable to be added
    - “data” - The songName, songArtistFullName, songAlbum, songAmountFaourites, and the id of the Song should all be returned if the Song is added successfully

  - Example Response:

    ```
    {
        "data": {
            "songName": "testDeleteSong",
            "songArtistFullName": "111",
            "songAlbum": "testDeleteSongArtist",
            "songAmountFavourites": "0",
            "id": "5d65df689a2efe318808f4cc"
    }
    	"status": "OK"
    }
    
    ```

  #### PUT /updateSongFavouritesCount/{songId}?shouldDecrement=

  - Description: Updates the song’s favourites count
  - URL Parameters: 
    - songId - a String that represents the _id of a specific song
  - Query Parameters: 
    - shouldDecrement - States whether the song count should be incremented or decremented by 1. Accepts string values of “true” or “false”
  - Expected Response: 
    - "status"
      - “OK”,  if the song was updated successfully from all locations
      - <string>, any other status if the song’s favorite count was unable to be updated

### PROFILE MICROSERVICE

#### 	POST /profile

- Description:  Adds a profile to the Profile database, creates userName-favorites playlist and 	creates relation (nProfile:profile)-[:created]->(nPlaylist:playlist) 
- Body Parameters: 
  - userName - The name of the Profile 
  - fullName - The full name of the User of the profile 
  - password- The password associated with the ProfilesongId - a String that represents the 		_id of a specific song 
- Expected Response: 
  - “status” 
    - “OK”,  if Profile is created and added correctly to the database
    - <string>, any other status if the Profile was unable to be created

#### 	PUT /followFriend/{userName}/{friendUserName}

- Description:  Allows a Profile to follow another Profile and become a friend
- URL Parameters: 
  - userName - The userName of the Profile that will follow another Profile
  - friendUserName -  The userName of the Profile that will be followed 
- Expected Response: 
  - “status” 
    - “OK”,  if the user is able to follow the specified User
    - <string>, any other status if the Profile was unable to follow the specified Profile

#### 	PUT /unfollowFriend/{userName}/{friendUserName}

- Description:  Allows a Profile to unfollow another Profile and no longer be “friends” with them
- URL Parameters: 
  - userName - The userName of the Profile that will unfollow another Profile
  - friendUserName -  The userName of the Profile that will be unfollowed 
- Expected Response: 
  - “status” 
    - “OK”,  if the user is able to unfollow the specified User
    - <string>, any other status if the Profile was not able to unfollow the specified Profile

#### 	PUT /likeSong/{userName}/{songId}

- Description:  Allows a Profile to like a song and add it to their favorites. You can like the same song twice.
- URL Parameters: 
  - userName - The userName of the Profile that is going to like the song (i.e. add the song to their favourites)
  - songId-  a String that represents the _id of the song that needs to be liked 
- Expected Response: 
  - “status” 
    - “OK”,  if the User is able to like the Song
    - <string>, any other status if the Profile was not able to like the specified Song

#### 	PUT /unlikeSong/{userName}/{songId}

- Description:  Allows a Profile to unlike a song and add it to their favorites. You cannot unlike the same song twice.
- URL Parameters: 
  - userName - The userName of the Profile that is going to unlike the song (i.e. add the song to their favourites)
  - songId-  a String that represents the _id of the song that needs to be unliked 
- Expected Response: 
  - “status” 
    - “OK”,  if the User is able to unlike the Song
    - <string>, any other status if the Profile was not able to unlike the specified Song (including going below 0)

#### 	GET /getAllFriendFavouriteSongTitles/{userName}

- Description:  Returns the Song names of all of the Songs that the User’s friends have liked

- URL Parameters: 

  - userName - The userName of the Profile whose friends songs we will retrieve
  - songId - a String that represents the _id of the song that needs to be unliked

- Expected Response: 

  - “status” 
    - “OK”, if the User is able to unlike the Song
    - <string>, any other status if the Profile was not able to unlike the specified Song

- Example Response:

  ```
  {
      "data": {
          "tahmid": [
              "The Lego Movie",
              "Henry IV",
              "Land of Milk and Honey"
          ],
          "shabaz": [
              "Sliver",
              "Off the Black",
              "The Lego Movie"
          ]
      },
      "status": "OK"
  }
  ```

## Support

For any questions contact  me at gurashish1000@gmail.com
